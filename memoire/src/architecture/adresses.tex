\section{Format d'adresse}\label{sec:archi-adresses}
\renewcommand{\rightmark}{Format d'adresse}

Cette section décrit les possibilités envisagées pour le choix du format des adresses utilisées pour les communications LoRa et motive le choix d'un format. Dans chaque hypothèse, un réseau RPL possède un préfixe de sous-réseau qui lui est propre.

\subsection*{Adresse IPv6}
    La première solution envisagée est d'utiliser les adresses IPv6 des noeuds.
    Une racine RPL peut ainsi vérifier si un paquet est destiné à son réseau et la racine LoRa à elle même,
    via le préfixe de sous réseau de l'adresse de destintation.
    Cette solution est la plus simple à mettre en oeuvre car elle ne nécéssite pas de table de routage ou de processus de conversion d'adresse. Cette approche a néanmoins le désavantage que les adresses IP de 128 bits sont transportées sur un lien LoRa ce qui représente un temps de transmission important.
    
    Néanmoins la taille des adresses IP est de 128 bits.

\subsection*{Préfixe et \textit{node-id}}
    Une seconde approche est d'utiliser un préfixe et le \textit{node-id}. Ce dernier est un identifiant de noeud sur 16 bits utilisé dans Contiki. Son calcul, basé sur les deux derniers octets de l'adresse MAC du noeud (\textit{link-layer address}) est le suivant:
    \[
        node\_id = link\_addr[s-1] + (link\_addr[size -2] << 8)
    \]
    où $s$ est la taille de la \textit{link-layer address}.\\

    Le format d'adresse utilisé serait alors un préfixe sur 8 bits et le \textit{node-id} sur 16 bits ce qui fait un total de 24 bits.

    L'avantage de cette solution est que la taille des adresses est réduite d'un facteur de 18,75\%. Néanmoins, un processus de conversion est nécessaire ainsi qu'une table de conversion d'un \textit{node-id} vers une adresse MAC pour chaque noeud RPL. En effet, le calcul du \textit{node-id} ne permet pas de reconstituer l'adresse MAC de 64 bits à partir de celui-ci.
    Un autre inconvénient est que l'utilisation du préfixe de 8 bits limite le nombre de réseaux RPL à 256, ce qui reste néanmoins acceptable.
    % === infos ===
    % Dans contiki, la link layer address est "remplie" dans arch/zoul/platform.c par
    % `ieee_addr_cpy_to(linkaddr_node_addr.u8, LINKADDR_SIZE);` qui est définie dans
    % arch/cpu/cc2538/iee-addr.c qui va lire l'adresse dans la mémoire flash du cc2538
    % sauf si IEEE_ADDR_CONF_HARDCODED est définie. Dans ce cas c'est une adresse harcodée
    % qui est utilisée
    %

\subsection*{Préfixe et adresse MAC}
    Pour résoudre le problème de la conversion \textit{node-id}$\leftrightarrow	$ adresse MAC, cette solution consiste à remplacer le \textit{node-id} par l'adresse MAC d'un noeud.

    Cette solution permet une conversion d'adresse simple et la taille des adresses est de 72 bits (64 bits de l'adresse MAC et 8 bits du préfixe).

\subsection*{Solution retenue}
    La solution retenue est l'utilisation du préfixe de 8 bits et du \textit{node-id} car c'est la solution qui offre les adresses les plus courtes. Pour éviter l'utilisation d'une table de conversion \textit{node-id}$\leftrightarrow$ adresse MAC, une meilleure solution que d'utiliser les adresses MAC des noeuds et de modifier les 6 premiers octets de cette dernière. Cela permet de reconstituer une adresse IPv6 simplement, mais cela réduit le nombre d'adresses possible
    Malgré tout, le nombre d'adresse possible reste largement suffisant pour ce projet.

    L'adresse de la racine LoRa est une adresse configurée administrativement.

    %todo schéma conversion, adresse de la racine 