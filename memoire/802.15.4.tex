\section{IEEE 802.15.4}\label{sec:etat_art-802.15.4}
\renewcommand{\rightmark}{IEEE 802.15.4}

  802.15.4 est un protocole définis par IEEE en 2003. Il est destiné aux
  communications à débit faibles réalsisées par des dispositifs ayant une
  alimentation en énergie limitée.
  Ce protocole, qui est un standart pour les réseaux PANs (Personak Area
  Networks) couvre la couche physique et MAC du modèle OSI.

\subsection{Types de noeuds}\label{subsec:etat_art-802.15.4.nodes}
  La norme 802.15.4 défini deux types de noeuds:
  \begin{itemize}[label=\textbullet]
    \item Les noeuds \textbf{FFD} (Full Function Device) peuvent être des corrdinateurs de PAN, de simple
          coordinateurs ou de simple noeuds.
    \item Les noeuds \textbf{RFD} (Reduced Function Device) utilisent une implémentation réduite du protocole
    et peuvent seulement opérer comme des simples noeuds.  
  \end{itemize}

\subsection{Topologies}\label{subsec:etat_art-802.15.4.topologies}
  Ces noeuds peuvent former des réseaux suivants plusieurs topologies: la topologie en étoile (Fig
  \ref{fig:etat_art-802.15.4.topology.star}) pour laquelle plusieurs RFD sont connectés à un FFD qui
  joue le rôle de coordinateur, la topologie peer-to-peer
  (Fig \ref{fig:etat_art-802.15.4.topology.p2p}) pour laquelle les FFD sont connectés les uns aux autres.
  \begin{figure}[H]
    \makebox[\textwidth][c]{
    \begin{minipage}{0.5\textwidth}
      \centering
      \includegraphics[scale=0.35]{images/802154_topologies_p2p.png}
      \caption{802.14.4 topologie peer-to-peer.}
      \label{fig:etat_art-802.15.4.topology.p2p}
    \end{minipage}
    \hspace{1cm}
    \begin{minipage}{0.5\textwidth}
      \centering
      \includegraphics[scale=0.35]{images/802154_topologies_star.png}
      \caption{802.15.4 topologie en étoile.}
      \label{fig:etat_art-802.15.4.topology.star}
    \end{minipage}}
  \end{figure}


\subsection{Beacon Enabled mode}\label{subsec:etat_art-802.15.4.be}
  Dans ce mode d'accès, le réseau est synchronisé par des messages de contrôles (beacons)
  et une structure appelée Superframe (Fig. \ref{fig:etat_art-802.15.4.superframe}).
  Cette Superframe est générée périodiquement par les coordinateurs.
  Elle est délimitée par des beacons qui sont émis à un intervalle \textit{beacon interval (BI)}
  qui est défini par le paramètre \textit{beacon order (BO)}
  $BI = 15.36 \cdot 2^{BO}\ avec\ 0 \leq BO \leq 14$.
  
  La superframe peut être divisée en deux périodes: la période active et la période inactive.
  La période active a une durée \textit{Superframe duration (SD)} qui est définie par 
  le paramètre \textit{Superframe order (SO)} $SD=15.36 \cdot 2^{SO}\ avec\ 0 \leq SO \leq BO \leq 14$.
  Elle est elle-même divisée en deux périodes:
  \textit{contention acces period (CAP)} et \textit{contention free period (CFP)}.
  %Pendant la CAP, l'accès au canal se fait par l'algorithme CSMA-CA (Carrier Sense Multiple Access with Collision Avoidance).
  %Pour la CFP, chaque noeud utilise un slot (Guaranteed Time Slots (GTS)) parmi les 7 disponibles.
  \begin{figure}[H]
    \centering
    \makebox[\textwidth]
    {
      \includegraphics[scale=0.8]{images/superframe.png}
    }
    \caption{802.15.4 structure de la Superframe.}
    \label{fig:etat_art-802.15.4.superframe}
  \end{figure}

\subsubsection*{Accès au canal durant la contention acces period (CAP)}
  Durant cette période, l'accès au canal se fait par l'algotihme slotted CSMA-CA
  (Carrier Sense Multiple Access with Collision Avoidance). La figure~\ref{fig:etat_art-csmaca}
  illustre son fonctionnement.

  Les time slots de la CAP sont divisés en plus petits time slots appelés \textbf{backoff periods}.
  Un noeud du réseau maintient les variables suivantes:
  \begin{itemize}[label=\textbullet]
    \item $NB$ compte le nombre de backoff. Initialisée à 0
    \item $CW$ indique la taille de la fenêtre de congestion. Initialisée à 2
    \item $BE$ est l'exposant du backoff. Initialisée à macMinBE
  \end{itemize}

  Les variables macMinBE, macMaxBe et MCB (macCSMABackoffs) sont des constantes du protocole.
  Lorsque des paquets doivent être transmis, les variables sont d'abord initialisées.
  Ensuite, le noeud attend le prochain backoff et choisis aléatoirement un nombre entier
  $r r \in [0, 2^{BE}-1]$. Après avoir avoir attendu r backoff periods, le noeud vérifie
  si le canal est occupé en réalisant un CCA (Clear Channel Assessment).
  Si c'est le cas, $CW$ va être décrémenté et un nouveau CCA va être réalisé.
  Les paquets ne pourront être transmis qu'après trois CCA consécutifs indiquant un canal libre (i.e. $CW = 0$).
  Si le canal est occupé, $NB$ et $BE$ sont incrémentés et $CW$ est réinitialisé à 2.
  Enfin, si $NB$ n'exède pas \textit{macCSMABackoffs}, le noeud va reprendre à l'étape où un
  $r$ est choisis aléatoirement. Sinon, la communication ne sera pas établie et les paquets
  ne seront pas transférés.


\begin{figure}[H]
\begin{tikzpicture}[node distance=1.7cm]

  \node (start) [process] {\begin{tabular}{c} $NB = 0$; $CW = 2$ \\ BE = macMinBE \end{tabular}};
  \node (in1) [process, below of=start] {\begin{tabular}{c} wait until next backoff\\ period boundary\end{tabular}};
  \node (pro1) [process, below of=in1] {\begin{tabular}{c} Skip $r \in [0, 2^{BE}-1]$ \\ backoff periods \end{tabular}};
  \node (pro2) [process, below of=pro1] {Perform CCA};
  \node (dec1) [decision, below of=pro2, yshift=-0.8cm] {Channel idle?};

  \node (pro2a) [process, below of=dec1, yshift=-1cm] {\begin{tabular}{c} $NB = NB+1;CW = 2$ \\ $BE = min(BE+1, macMaxBE)$ \end{tabular}};
  \node (pro2b) [process, right of=pro2a, xshift=4cm] {$CW = CW-1$};
  \node (dec2) [decision, below of=pro2a, yshift=-1cm] {NB > MCB ?};
  \node (dec3) [decision, below of=pro2b, yshift=-1cm] {CW = 0\ ?};
  \node (fail) [endfail, below of=dec2, yshift=-1cm] {Failure};
  \node (success) [endsuccess, below of=dec3, yshift=-1cm] {Success};
  
  \draw [arrow] (start) -- (in1);
  \draw [arrow] (in1) -- (pro1);
  \draw [arrow] (pro1) -- (pro2);
  \draw [arrow] (pro2) -- (dec1);
  \draw [arrow] (dec1) -| node[anchor=south] {Yes} (pro2b);
  \draw [arrow] (dec1) -- node[anchor=east] {No} (pro2a);
  \draw [arrow] (pro2a) -- (dec2);
  \draw [arrow] (pro2b) -- (dec3);
  \draw [arrow] (dec2) -- node[anchor=east] {Yes} (fail);
  \draw [arrow] (dec2) -- node[anchor=south] {No} ++(-4,0) |- (pro1);
  \draw [arrow] (dec3) -- node[anchor=south] {No} ++(3,0) |- (pro2);
  \draw [arrow] (dec3) -- node[anchor=east] {Yes} (success);
  \end{tikzpicture}
  \caption{Schéma de l'algorithme slotted CSMA-CA.}
  \label{fig:etat_art-csmaca}
\end{figure}



\subsubsection{Accès au canal durant la contention free period} (CFP)
TODO

\subsection{Non-Beacon Enabled mode}\label{subsec:etat_art-802.15.4.nbe}

\subsection{Adressage}\label{subsec:etat_art-802.15.4.adress}

\subsection{Mécanisme d'Ack optionnel}\label{subsec:etat_art-802.15.4.ack}
